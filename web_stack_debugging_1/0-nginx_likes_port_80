#!/usr/bin/env bash
# This script ensures Nginx is installed, running, and listening on port 80 of all active IPv4 IPs.

# Install necessary packages
apt-get update -y
apt-get install -y nginx

# Ensure default configuration exists
if [ ! -f /etc/nginx/sites-enabled/default ]; then
  cp /etc/nginx/sites-available/default /etc/nginx/sites-enabled/
fi

# Configure Nginx to listen on port 80
sed -i '/listen 80 default_server;/c\listen 80 default_server;' /etc/nginx/sites-enabled/default
sed -i '/listen \[::\]:80 default_server;/c\listen [::]:80 default_server;' /etc/nginx/sites-enabled/default

# Restart Nginx service
service nginx restart

# Validate configuration
nginx -t && service nginx reload

